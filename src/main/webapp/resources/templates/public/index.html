<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="/resources/css/index.css" rel="stylesheet"/>
</head>
<body>
    <main>
        <div class="containerLeft">
            <div th:each="media : ${medias}">
                <img th:src="${media.getPosterPath()}" width="170px" height="240px" alt = "Постер">
                <a th:text="${media.getMediaName()}" th:href="@{/index/media/{id}(id = ${media.getId()})}"></a>
                <p th:text="${media.getType().typeName}"></p>
                <p th:text="${media.getYearOfRelease()}"></p>
            </div>
        </div>
        <aside class="containerRight">
            <div>
                    <span><strong>СОРТИРОВКА:</strong></span>
                    <button class="sortButton" data-param="id">По id</button>
                    <button class="sortButton" data-param="mediaName">По названию</button>
                    <button class="sortButton" data-param="yearOfRelease">По году выхода</button>
                    <button class="sortButton" data-param="rating">По рейтингу</button>
            </div>
            <div>
                    <span><strong>Фильтрация</strong></span>
                <div> По тэгам
                    <ul th:each="tag : ${tags}">
                        <li th:text="${tag.getTagName()}" th:value="${tag.getId()}"></li>
                    </ul>
                </div>
                <div> По типам
                    <ul th:each="type : ${types}">
                        <li th:text="${type.getTypeName()}" th:value="${type.getId()}"></li>
                    </ul>
                </div>
                <div> По статусу
                    <ul th:each="status : ${statuses}">
                        <li th:text="${status.getStatusName()}" th:value="${status.getId()}"></li>
                    </ul>
                </div>
                <div> По количеству серий
                    <ul>
                        <li th:text="${episodeDurations[0]} + ' (до 12 серий)'" th:value="${episodeDurations[0]}"></li>
                        <li th:text="${episodeDurations[1]} + ' (до 30 серий)'" th:value="${episodeDurations[1]}"></li>
                        <li th:text="${episodeDurations[2]} + ' (более 31 серии)'" th:value="${episodeDurations[2]}"></li>
                    </ul>
                </div>
                <div> По дате выхода
                    <ul th:each="releasePeriod : ${releasePeriods}">
                        <li th:text="${releasePeriod}" th:value="${releasePeriods}"></li>
                    </ul>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // Обработчик выбора элементов списка
        $('ul').on('click', 'li', function() {
            // Получаем текст и значение выбранного элемента
            let text = $(this).text();
            let value = $(this).attr('th:value');

            // Здесь вы можете выполнить дополнительные действия с выбранным текстом и значением
            console.log('Выбрано: ' + text + ', Значение: ' + value);
        });
    </script>

    <script>
        let buttons = document.getElementsByClassName('sortButton');
        Array.from(buttons).forEach(function(button) {
            button.addEventListener('click', function() {
                let currentUrl = window.location.href;
                let param = this.getAttribute('data-param');
                fetch(currentUrl.includes("?order=") ? removeParam("order", currentUrl) : currentUrl + '?order=' + param)
                    .then(response => response.text())
                    .then(data => {
                        if (currentUrl.includes("?order=")){
                            currentUrl = removeParam("order", currentUrl);
                            currentUrl = currentUrl + '?order=' + param;
                            window.location.href = currentUrl;
                        } else
                            window.location.href = currentUrl + '?order=' + param;
                    })
                    .catch(error => console.error('Ошибка:', error));
            });
        });
        function removeParam(key, sourceURL) {
            let rtn = sourceURL.split("?")[0],
                param,
                params_arr = [],
                queryString = (sourceURL.indexOf("?") !== -1) ? sourceURL.split("?")[1] : "";
            if (queryString !== "") {
                params_arr = queryString.split("&");
                for (let i = params_arr.length - 1; i >= 0; i -= 1) {
                    param = params_arr[i].split("=")[0];
                    if (param === key) {
                        params_arr.splice(i, 1);
                    }
                }
                rtn = rtn + "?" + params_arr.join("&");
            }
            return rtn;
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</body>
</html>