<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <tr th:each="media : ${medias}">
        <img th:src="${media.getPosterPath()}" width="170px" height="240px" alt = "Постер">
        <a th:text="${media.getMediaName()}" th:href="@{/index/media/{id}(id = ${media.getId()})}"></a>
        <p th:text="${media.getType().typeName}"}></p>
        <p th:text="${media.getYearOfRelease()}"}></p>
    </tr>
    <p>
        <span><strong>СОРТИРОВКА:</strong></span>
        <button class="sortButton" data-param="id">По id</button>
        <button class="sortButton" data-param="mediaName">По названию</button>
        <button class="sortButton" data-param="yearOfRelease">По году выхода</button>
        <button class="sortButton" data-param="rating">По рейтингу</button>
    </p>

<!--    <form th:action="@{index/media/filter}" method="get">-->
<!--        <label for="type">Тип:</label>-->
<!--        <select id="type" name="typeId">-->
<!--        </select>-->

<!--        <label for="tags">Тэги:</label>-->
<!--        <select id="tags" name="tagIds" multiple>-->
<!--        </select>-->

<!--        <button type="submit">Применить фильтр</button>-->
<!--    </form>-->

<!--    &lt;!&ndash; Отображение результатов &ndash;&gt;-->
<!--    <div th:each="media : ${filteredMedia}">-->
<!--    </div>-->

    <script>
        let buttons = document.getElementsByClassName('sortButton');
        Array.from(buttons).forEach(function(button) {
            button.addEventListener('click', function() {
                let currentUrl = window.location.href;
                let param = this.getAttribute('data-param');
                fetch(currentUrl.includes("?order=") ? removeParam("order", currentUrl) : currentUrl + '?order=' + param)
                    .then(response => response.text())
                    .then(data => {
                        if (currentUrl.includes("?order=")){
                            currentUrl = removeParam("order", currentUrl);
                            currentUrl = currentUrl + '?order=' + param;
                            window.location.href = currentUrl;
                        } else
                            window.location.href = currentUrl + '?order=' + param;
                    })
                    .catch(error => console.error('Ошибка:', error));
            });
        });
        function removeParam(key, sourceURL) {
            let splitUrl = sourceURL.split('?'),
                rtn = splitUrl[0],
                param,
                params_arr = [],
                queryString = (sourceURL.indexOf("?") !== -1) ? splitUrl[1] : '';
            if (queryString !== '') {
                params_arr = queryString.split('&');
                for (let i = params_arr.length - 1; i >= 0; i -= 1) {
                    param = params_arr[i].split('=')[0];
                    if (param === key) {
                        params_arr.splice(i, 1);
                    }
                }
            }
            return rtn
        }
    </script>
</body>
</html>